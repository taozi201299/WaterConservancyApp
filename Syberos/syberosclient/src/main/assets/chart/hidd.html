<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title data-i18n="resources.title_tiandituLayer_ll"></title>
    <script type="text/javascript" src="../ol-debug.js"></script>
    <link rel="stylesheet" href="../ol.css">
    <script type="text/javascript" src="../AJLib.min.js"></script>
    <link rel="stylesheet" href="../AJLib.min.css">
</head>
<body style=" margin: 0;overflow: hidden;background: #fff;width: 100%;height:100%;left: 0;right: 0;top: 0;bottom: 0;position: absolute;display: block;">
<div id="map" style="width: 100%;height:100%"></div>
<script type="text/javascript">
function showMap(x, y,level) {
alert(x);
alert(y);
    // 初始化全局地图变量
    window.mapDEMO = window.mapDEMO || {};
    debugger
    // 初始化地图分辨率、比例尺等地图必要数据
    mapDEMO.mapOption = mapDEMO.mapOption || {};
    if(!mapDEMO.map){
        mapDEMO.map = new AJMap.Map('map',{
          BaseLayer: AJMap.BASELAYER.DMZ_TDTSL,
            ThemeLayers: {
                [AJMap.THEMESLAYER.DMZ_TDTSL]:false
            },
            zoomLevel: level,
            defaultControl:{
                layerswitch:true
            },
            centerPoint: {
                             centerX: x,
                             centerY: y
                         },
            annotationVisible:true,
        });
    }
    }
    function showMapMark(x,y,x1,y1,level) {
    // 初始化全局地图变量
    window.mapDEMO = window.mapDEMO || {};
    // 初始化地图分辨率、比例尺等地图必要数据
    mapDEMO.mapOption = mapDEMO.mapOption || {};
    if(!mapDEMO.map){
        mapDEMO.map = new AJMap.Map('map',{
          BaseLayer: AJMap.BASELAYER.DMZ_TDTSL,
            ThemeLayers: {
                [AJMap.THEMESLAYER.DMZ_TDTSL]:false
            },
            zoomLevel: level,
            defaultControl:{
                layerswitch:true
            },
            annotationVisible:true,
        });
        mapDEMO.map.moveToExtent([x,y,x1,y1]);
    }
    }
    function  findCache(imageTile,id,src) {
         var result = window.DEMO.getLocalUrl(id,src);
         imageTile.getImage().src = result
    }
var current_point_vector_layer = null;
function updateCurrentPoint(x, y) {
    // 删除旧的点
    if (null != current_point_vector_layer) {
        mapDEMO.map.getCustomLayerGroup().removeLayer(current_point_vector_layer);
    }

    // 初始化 source 源
    var vectorSource = new ol.source.Vector({ wrapX: false });

    // 初始化图层
    current_point_vector_layer = new ol.layer.Vector({source: vectorSource, id:'current_point_vector'});

    // 初始化 feature start
    var Coordinates = [x, y];
    var iconFeature = new ol.Feature(
                {
                    geometry: new ol.geom.Point(Coordinates),
                    id:'current_point_vector_feature'
                }
                );

    var style = new ol.style.Style(
                {
                    image: new ol.style.Icon(({
                                                  src: './images/component/now.png',
                                                  scale: 0.05
                                              }))
                }
                );
    iconFeature.setStyle(style);

    current_point_vector_layer.getSource().addFeature(iconFeature);
    // 初始化 feature end

    // 图层加到容器中
    mapDEMO.map.getCustomLayerGroup().addLayer(current_point_vector_layer);
    return iconFeature;
}
    function showMarkInfo(x,y) {
    var feature = updateCurrentPoint(x,y);
    var overlay = new AJMap.Popup({
                                 id:'current_point_vector_feature',
                                 popupClass: "default",
                                 closeBox: true,
                                 onshow: function(){ console.log("You opened the box"); },
                                 onclose: function(){ console.log("You close the box"); },
                                 positioning: 'auto',
                                 autoPan: true,
                                 autoPanAnimation: { duration: 250 }
                              });
    mapDEMO.map.addOverlay(overlay);
    alert('hello');
    alert(overlay);
    alert(feature.getGeometry().getCoordinates());
   overlay.show(feature.getGeometry().getCoordinates(),'<div>hello</div>');
    alert('helleo');
    }
</script>

</body>
</html>